-- DayTrader schema for H2
-- Intentionally idempotent (safe to run on every startup).

CREATE TABLE IF NOT EXISTS ACCOUNTPROFILEEJB (
  ADDRESS VARCHAR(250),
  PASSWD VARCHAR(250),
  USERID VARCHAR(250) NOT NULL,
  EMAIL VARCHAR(250),
  CREDITCARD VARCHAR(250),
  FULLNAME VARCHAR(250),
  CONSTRAINT PK_ACCOUNTPROFILEEJB PRIMARY KEY (USERID)
);

CREATE TABLE IF NOT EXISTS KEYGENEJB (
  KEYVAL INTEGER NOT NULL,
  KEYNAME VARCHAR(250) NOT NULL,
  CONSTRAINT PK_KEYGENEJB PRIMARY KEY (KEYNAME)
);

MERGE INTO KEYGENEJB (KEYNAME, KEYVAL) KEY (KEYNAME) VALUES ('account', 0);
MERGE INTO KEYGENEJB (KEYNAME, KEYVAL) KEY (KEYNAME) VALUES ('holding', 0);
MERGE INTO KEYGENEJB (KEYNAME, KEYVAL) KEY (KEYNAME) VALUES ('order', 0);

CREATE TABLE IF NOT EXISTS ACCOUNTEJB (
  CREATIONDATE TIMESTAMP,
  OPENBALANCE DECIMAL(14, 2),
  LOGOUTCOUNT INTEGER NOT NULL,
  BALANCE DECIMAL(14, 2),
  ACCOUNTID INTEGER NOT NULL,
  LASTLOGIN TIMESTAMP,
  LOGINCOUNT INTEGER NOT NULL,
  PROFILE_USERID VARCHAR(250),
  CONSTRAINT PK_ACCOUNTEJB PRIMARY KEY (ACCOUNTID)
);

CREATE TABLE IF NOT EXISTS QUOTEEJB (
  LOW DECIMAL(14, 2),
  OPEN1 DECIMAL(14, 2),
  VOLUME DOUBLE NOT NULL,
  PRICE DECIMAL(14, 2),
  HIGH DECIMAL(14, 2),
  COMPANYNAME VARCHAR(250),
  SYMBOL VARCHAR(250) NOT NULL,
  CHANGE1 DOUBLE NOT NULL,
  CONSTRAINT PK_QUOTEEJB PRIMARY KEY (SYMBOL)
);

CREATE TABLE IF NOT EXISTS HOLDINGEJB (
  PURCHASEPRICE DECIMAL(14, 2),
  HOLDINGID INTEGER NOT NULL,
  QUANTITY DOUBLE NOT NULL,
  PURCHASEDATE TIMESTAMP,
  ACCOUNT_ACCOUNTID INTEGER,
  QUOTE_SYMBOL VARCHAR(250),
  CONSTRAINT PK_HOLDINGEJB PRIMARY KEY (HOLDINGID)
);

CREATE TABLE IF NOT EXISTS ORDEREJB (
  ORDERFEE DECIMAL(14, 2),
  COMPLETIONDATE TIMESTAMP,
  ORDERTYPE VARCHAR(250),
  ORDERSTATUS VARCHAR(250),
  PRICE DECIMAL(14, 2),
  QUANTITY DOUBLE NOT NULL,
  OPENDATE TIMESTAMP,
  ORDERID INTEGER NOT NULL,
  ACCOUNT_ACCOUNTID INTEGER,
  QUOTE_SYMBOL VARCHAR(250),
  HOLDING_HOLDINGID INTEGER,
  CONSTRAINT PK_ORDEREJB PRIMARY KEY (ORDERID)
);

CREATE INDEX IF NOT EXISTS ACCOUNT_USERID ON ACCOUNTEJB(PROFILE_USERID);
CREATE INDEX IF NOT EXISTS HOLDING_ACCOUNTID ON HOLDINGEJB(ACCOUNT_ACCOUNTID);
CREATE INDEX IF NOT EXISTS ORDER_ACCOUNTID ON ORDEREJB(ACCOUNT_ACCOUNTID);
CREATE INDEX IF NOT EXISTS ORDER_HOLDINGID ON ORDEREJB(HOLDING_HOLDINGID);
CREATE INDEX IF NOT EXISTS CLOSED_ORDERS ON ORDEREJB(ACCOUNT_ACCOUNTID, ORDERSTATUS);
